<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>Ajax学习笔记</title>
		<link rel="stylesheet" href="../css/blogs.css">
	</head>
	<body>
	  <h2>Ajax学习笔记</h2>
    <p>要想使用Ajax, 需要先创建XMLHttpRequest对象<code>var xhr = new XMLHttpRequest();</code>, 这样我就可以使用XHR对象的方法从服务器请求数据了</p>
    <p>第一个方法是<code>open()</code>, 有3个参数：请求类型、请求url、是否异步请求，例如：<code>xhr.open("get", "test.txt", true);</code><br>
      <code>open()</code>方法并不会发送请求，只是启动请求以备发送</p>
    <p>要发送请求需要调用<code>send()</code>方法<code>xhr.send(null);</code><br>
      <code>send()</code>方法有一个参数，即向服务器发送的数据，如果没有数据发送，就传入<code>null</code></p>
    <p>收到服务器的响应后，响应数据会保存在xhr对象的属性中，相关属性如下：</p>
    <ul>
      <li>responseText: 返回的数据</li>
      <li>status: HTTP状态码</li>
      <li>statusText: HTTP状态说明</li>
    </ul>
    <p>为了收到正确的响应，在使用返回的数据前应该判断HTTP状态</p>
<pre>
xhr.open("get", "test.txt", false);
xhr.send(null);
if ( (xhr.status >= 200 && xhr.status < 300) || xhr.status === 304 ) {
  console.log(xhr.status + ": " + xhr.statusText + ": " + xhr.responseText);
} else {
  console.log(xhr.status + ": " + xhr.statusText + ": " + xhr.responseText);
}
</pre>
    <p>如果发送的是异步请求，还需要检测xhr对象的<code>readyState</code>属性，该属性表示整个请求响应过程的不同阶段，该属性的值有如下几种：</p>
    <ul>
      <li>0：尚未调用<code>open()</code>方法</li>
      <li>1：已调用<code>open()</code>方法，未调用<code>send()</code>方法</li>
      <li>2：已调用<code>send()</code>方法，未收到响应</li>
      <li>3：收到部分响应数据</li>
      <li>4：收到全部响应数据，并可以使用数据了</li>
    </ul>
    <p>只要<code>readyState</code>属性的值改变就会触发<code>onreadystatechange</code>事件</p>
    <p>所以完整的请求响应过程是这样的：</p>
<pre>
var xhr = new XMLHttpRequest();
xhr.onreadystatechange = function () {
  if (xhr.readyState === 4) {
    if ( (xhr.status >= 200 && xhr.status < 300) || xhr.status === 304 ) {
      console.log(xhr.status + ": " + xhr.statusText + ": " + xhr.responseText);
    } else {
      console.log(xhr.status + ": " + xhr.statusText + ": " + xhr.responseText);
    }
  }
};
xhr.open("get", "test.txt", true);
xhr.send(null);
</pre>
    <span class="time">2016-07-27 11:18:18</span>
	</body>
</html>
